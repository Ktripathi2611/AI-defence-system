{% extends "dashboard/base.html" %}

{% block title %}Dashboard - AI Defense System{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-shield-alt text-primary"></i>
                        Total Scans
                    </h5>
                    <h2 class="card-text">{{ statistics.total_scans }}</h2>
                    <p class="text-muted">Total security scans performed</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-exclamation-triangle text-warning"></i>
                        Threats Detected
                    </h5>
                    <h2 class="card-text">{{ statistics.threats_detected }}</h2>
                    <p class="text-muted">Security threats identified</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-chart-line text-success"></i>
                        Safety Score
                    </h5>
                    <h2 class="card-text">{{ statistics.safety_score }}%</h2>
                    <p class="text-muted">Overall security rating</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Recent Scans -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-history"></i>
                        Recent Scans
                    </h5>
                </div>
                <div class="card-body">
                    {% if scans %}
                    <div class="list-group">
                        {% for scan in scans %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">{{ scan.scan_type|title }} Scan</h6>
                                <small class="text-muted">{{ scan.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
                            </div>
                            <p class="mb-1">{{ scan.target }}</p>
                            <small class="text-{{ 'danger' if scan.result == 'detected' else 'success' }}">
                                {{ scan.result|title }}
                                {% if scan.score %}
                                (Confidence: {{ "%.2f"|format(scan.score) }})
                                {% endif %}
                            </small>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted">No recent scans</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Recent Alerts -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bell"></i>
                        Recent Alerts
                    </h5>
                </div>
                <div class="card-body">
                    {% if alerts %}
                    <div class="list-group">
                        {% for alert in alerts %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">{{ alert.alert_type|title }}</h6>
                                <small class="text-muted">{{ alert.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
                            </div>
                            <p class="mb-1">{{ alert.message }}</p>
                            <small class="text-{{ 'danger' if alert.severity == 'high' else 'warning' if alert.severity == 'medium' else 'info' }}">
                                {{ alert.severity|title }} Severity
                            </small>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted">No recent alerts</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Refresh dashboard data every 30 seconds
    setInterval(function() {
        location.reload();
    }, 30000);
</script>
{% endblock %}
